<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>카테고리 선택 - AI Quiz</title>
    <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet">
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-8xl mt-12">
        <div class="relative mb-8">
            <div class="absolute top-0 right-0">
                <button id="userButton" class="p-2 rounded-full bg-white shadow-lg hover:shadow-xl transition-all duration-200 hover:bg-gray-50">
                    <svg class="w-8 h-8 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                </button>

                <div id="userPopup" class="hidden absolute top-12 right-0 w-64 bg-white rounded-lg shadow-xl border border-gray-200 z-50">
                    <div class="p-4 border-b border-gray-100">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                </svg>
                            </div>
                            <div>
                                <h3 id="popupUsername" class="font-semibold text-gray-800">사용자</h3>
                                <p id="popupEmail" class="text-sm text-gray-500">정보를 불러오는 중...</p>
                            </div>
                        </div>
                    </div>
                    <div class="py-2">
                        <a href="#" id="logoutButton" class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors duration-150">
                            <div class="flex items-center space-x-2">
                                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                                </svg>
                                <span>로그아웃</span>
                            </div>
                        </a>
                    </div>
                </div>
            </div>

            <div class="text-center">
                <h1 class="text-4xl font-bold text-gray-800 mb-2">퀴즈 테마 선택</h1>
                <p class="text-xl text-gray-600">원하는 카테고리를 선택해서 퀴즈를 시작하세요!</p>
            </div>
        </div>

        <div class="mb-8">
            <div class="relative max-w-8xl mx-auto">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <svg class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
                <input
                    type="text"
                    placeholder="카테고리 검색..."
                    class="block w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg bg-white shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                    id="searchInput"
                >
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="categoryGrid">
            <div class="category-card bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:-translate-y-1">
                <div class="p-6">
                    <div class="w-full h-60 bg-gradient-to-br from-blue-400 to-blue-600 rounded-lg mb-4 flex items-center justify-center">
                        <img src="{{ url_for('static', filename='images/cat.jpg') }}" alt="고양이 카테고리 이미지" class="w-full h-full object-cover rounded-lg shadow-md" />
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">고양이</h3>
                    <p class="text-gray-600 text-lg">샴 등 다양한 품종의 고양이에 대한 퀴즈</p>
                </div>
            </div>

            <div class="category-card bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:-translate-y-1">
                <div class="p-6">
                    <div class="w-full h-60 bg-gradient-to-br from-amber-400 to-amber-600 rounded-lg mb-4 flex items-center justify-center">
                        <img src="{{ url_for('static', filename='images/icecream.jpg') }}" alt="아이스크림 카테고리 이미지" class="w-full h-full object-cover rounded-lg shadow-md" />
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">아이스크림</h3>
                    <p class="text-gray-600 text-lg">한국사, 세계사, 근현대사 등 역사 관련 퀴즈</p>
                </div>
            </div>

            <div class="category-card bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:-translate-y-1">
                <div class="p-6">
                    <div class="w-full h-60 bg-gradient-to-br from-purple-400 to-purple-600 rounded-lg mb-4 flex items-center justify-center">
                        <img src="{{ url_for('static', filename='images/rose.jpg') }}" alt="장미 카테고리 이미지" class="w-full h-full object-cover rounded-lg shadow-md" />
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">장미</h3>
                    <p class="text-gray-600 text-lg">고전문학, 현대문학, 세계문학 등 문학 관련 퀴즈</p>
                </div>
            </div>

            <div class="category-card bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:-translate-y-1">
                <div class="p-6">
                    <div class="w-full h-60 bg-gradient-to-br from-green-400 to-green-600 rounded-lg mb-4 flex items-center justify-center">
                        <img src="{{ url_for('static', filename='images/fruits.jpg') }}" alt="과일 카테고리 이미지" class="w-full h-full object-cover rounded-lg shadow-md" />
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">과일</h3>
                    <p class="text-gray-600 text-lg">세계 지리, 한국 지리, 자연지리 등 지리 관련 퀴즈</p>
                </div>
            </div>

            <div class="category-card bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:-translate-y-1">
                <div class="p-6">
                    <div class="w-full h-60 bg-gradient-to-br from-gray-400 to-white-400 rounded-lg mb-4 flex items-center justify-center border-1">
                        <svg  xmlns="http://www.w3.org/2000/svg"  width="60"  height="80"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-arrows-shuffle"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 4l3 3l-3 3" /><path d="M18 20l3 -3l-3 -3" /><path d="M3 7h3a5 5 0 0 1 5 5a5 5 0 0 0 5 5h5" /><path d="M21 7h-5a4.978 4.978 0 0 0 -3 1m-4 8a4.984 4.984 0 0 1 -3 1h-3" /></svg>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">랜덤</h3>
                    <p class="text-gray-600 text-lg">4가지의 카테고리 중 랜덤 퀴즈</p>
                </div>
            </div>

            <div class="category-card bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:-translate-y-1">
                <div class="p-6">
                    <div class="w-full h-60 bg-gradient-to-br from-white-400 to-gray-400 rounded-lg mb-4 flex items-center justify-center border-1">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-20">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" />
                        </svg>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">나만퀴(나만의 퀴즈 만들기)</h3>
                    <p class="text-gray-600 text-lg">내가 직접 만들어 보는 퀴즈</p>
                </div>
            </div>
        </div>

        <div id="noResults" class="hidden text-center py-12">
            <div class="text-gray-400 mb-4">
                <svg class="w-16 h-16 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.5-1.01-6-2.709M15 13.291A7.962 7.962 0 0112 15m3-2.709A7.962 7.962 0 0112 15m3-2.709v-.582m0 0a6.116 6.116 0 00-6-6.709 6.116 6.116 0 00-6 6.709m0 0v.582m0 0a6.116 6.116 0 006 6.709 6.116 6.116 0 006-6.709m0 0v-.582" />
                </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-600 mb-2">검색 결과가 없습니다</h3>
            <p class="text-gray-500">다른 키워드로 검색해보세요.</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const token = localStorage.getItem('accessToken');

            if (!token) {
                alert('로그인이 필요합니다.');
                window.location.href = '/welcome';
                return;
            }

            const userButton = document.getElementById('userButton');
            const userPopup = document.getElementById('userPopup');

            userButton.addEventListener('click', function(e) {
                e.stopPropagation();
                userPopup.classList.toggle('hidden');
            });

            document.addEventListener('click', function(e) {
                if (!userPopup.contains(e.target) && !userButton.contains(e.target)) {
                    userPopup.classList.add('hidden');
                }
            });

            async function fetchUserInfo() {
                try {
                    const response = await fetch('/auth/verify-token', {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        document.getElementById('popupUsername').textContent = data.username;
                        document.getElementById('popupEmail').textContent = '로그인 됨';
                    } else {
                        throw new Error('인증 실패');
                    }
                } catch (error) {
                    console.error('사용자 정보 로딩 실패:', error);
                    localStorage.removeItem('accessToken');
                    localStorage.removeItem('username');
                    alert('세션이 만료되었거나 유효하지 않습니다. 다시 로그인해주세요.');
                    window.location.href = '/welcome';
                }
            }

            fetchUserInfo();

            const logoutButton = document.getElementById('logoutButton');
            logoutButton.addEventListener('click', async function(e) {
                e.preventDefault();
                try {
                    const response = await fetch('/auth/logout', {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${token}` }
                    });

                    if (response.ok) {
                        alert('로그아웃되었습니다.');
                    }
                } catch (error) {
                    console.error('로그아웃 요청 실패:', error);
                } finally {
                    localStorage.removeItem('accessToken');
                    localStorage.removeItem('username');
                    window.location.href = '/welcome';
                }
            });

            const searchInput = document.getElementById('searchInput');
            const categoryCards = document.querySelectorAll('.category-card');
            const noResults = document.getElementById('noResults');
            const categoryGrid = document.getElementById('categoryGrid');

            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase().trim();
                let visibleCards = 0;

                categoryCards.forEach(card => {
                    const title = card.querySelector('h3').textContent.toLowerCase();
                    const description = card.querySelector('p').textContent.toLowerCase();

                    if (title.includes(searchTerm) || description.includes(searchTerm)) {
                        card.style.display = 'block';
                        visibleCards++;
                    } else {
                        card.style.display = 'none';
                    }
                });

                if (visibleCards === 0 && searchTerm !== '') {
                    noResults.classList.remove('hidden');
                    categoryGrid.classList.add('hidden');
                } else {
                    noResults.classList.add('hidden');
                    categoryGrid.classList.remove('hidden');
                }
            });

            categoryCards.forEach(card => {
                card.addEventListener('click', function() {
                    const categoryName = this.querySelector('h3').textContent;
                    window.location.href = `./levelselect?category=${encodeURIComponent(categoryName)}`;
                });
            });

            categoryCards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-8px)';
                });

                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                });
            });
        });
    </script>
</body>
</html>